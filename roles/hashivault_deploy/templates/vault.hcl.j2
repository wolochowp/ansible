# Managed by Ansible
# This file is auto-generated by the hashivault_deploy role.

# === UI & memory locking ===
ui = {{ hashivault_deploy_ui_enabled | lower }}
{% if hashivault_deploy_disable_mlock %}
disable_mlock = true
{% else %}
disable_mlock = false
{% endif %}
{% if hashivault_deploy_cluster_name %}
cluster_name = "{{ hashivault_deploy_cluster_name }}"
{% endif %}
# === API & cluster addresses ===
{% if hashivault_deploy_api_addr %}
api_addr = "{{ hashivault_deploy_api_addr }}"
{% endif %}

{% if hashivault_deploy_cluster_addr %}
cluster_addr = "{{ hashivault_deploy_cluster_addr }}"
{% endif %}

# === Storage, seal, listener, telemetry ===
{% if hashivault_deploy_storage_type == 'raft' %}
storage "raft" {
    path    = "{{ hashivault_deploy_raft_path | default('/opt/vault/data') }}"
    node_id = "{{ inventory_hostname }}"

    {% for host in play_hosts | reject('equalto', inventory_hostname) %}
    retry_join {
        leader_api_addr = "{{ hostvars[host].hashivault_deploy_vault_addr }}"
    }
    {% endfor %}
}
{% else %}
storage "{{ hashivault_deploy_storage_type }}" {
{% for key, value in hashivault_deploy_storage_config.items() %}
    {{ key }} = {{ value | to_nice_json }}
{% endfor %}
}
{% endif %}

{% if hashivault_deploy_seal_type != 'shamir' %}
seal "{{ hashivault_deploy_seal_type }}" {
{% for key, value in hashivault_deploy_seal_config.items() %}
  {{ key }} = {{ value | to_nice_json }}
{% endfor %}
}
{% endif %}

listener "tcp" {
  address = "{{ hashivault_deploy_bind_address }}"
  {% if hashivault_deploy_tls_enabled %}
  tls_cert_file = "{{ hashivault_deploy_tls_cert_file }}"
  tls_key_file  = "{{ hashivault_deploy_tls_key_file }}"
  {% else %}
  tls_disable = 1
  {% endif %}
}

{% if hashivault_deploy_telemetry %}
telemetry {
{% for key, value in hashivault_deploy_telemetry.items() %}
  {{ key }} = {{ value | to_nice_json }}
{% endfor %}
}
{% endif %}